-- ============================= CREACION DEL ESQUEMA DE LA BASE DE DATOS ====================
DROP DATABASE IF EXISTS `PMDB103_PROD`;
CREATE DATABASE `PMDB103_PROD`;
USE `PMDB103_PROD`;
-- ============================= TABLES (23) =======================
CREATE TABLE `EVENTO_SINCRONIZACION` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`FECHA_EVENTO`		TIMESTAMP		 NOT NULL ,
	`TIPO_EVENTO`		INTEGER	 (1)	 NOT NULL ,
	`AFECTACION_GLOBAL`		INTEGER	 (1)	 NOT NULL ,
	`SUCURSAL_ID_AFECTADA`		INTEGER	 (5)	 NOT NULL ,
	`TABLA`		VARCHAR	 (64)	 NOT NULL ,
	`CAMPOS_LLAVE`		VARCHAR	 (64)	 NOT NULL ,
	`VALORES_LLAVE`		VARCHAR	 (128)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `PRODUCTO` (
	`CODIGO_BARRAS`		VARCHAR	 (64)	 NOT NULL ,
	`INDUSTRIA`		VARCHAR	 (128)	 NOT NULL ,
	`LINEA`		VARCHAR	 (128)	 NOT NULL ,
	`MARCA`		VARCHAR	 (255)	 NOT NULL ,
	`NOMBRE`		VARCHAR	 (255)	 NOT NULL ,
	`PRESENTACION`		VARCHAR	 (255)	 NOT NULL ,
	`ABREBIATURA`		VARCHAR	 (128)	 ,
	`UNIDADES_X_CAJA`		INTEGER	 (10)	 NOT NULL ,
	`CONTENIDO`		VARCHAR	 (16)	 NOT NULL ,
	`UNIDAD_MEDIDA`		VARCHAR	 (8)	 NOT NULL ,
	`UNIDAD_EMPAQUE`		VARCHAR	 (10)	 NOT NULL ,
	`COSTO`		DOUBLE		 NOT NULL ,
	`COSTO_VENTA`		DOUBLE		 NOT NULL ,
	PRIMARY KEY (`CODIGO_BARRAS`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `USUARIO` (
	`EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`ABILITADO`		INTEGER	 (1)	 NOT NULL ,
	`NOMBRE_COMPLETO`		VARCHAR	 (128)	 NOT NULL ,
	`PASSWORD`		VARCHAR	 (64)	 NOT NULL ,
	PRIMARY KEY (`EMAIL`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ESTADO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`DESCRIPCION`		VARCHAR	 (32)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `CFD` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`ULTIMA_ACTUALIZACION`		TIMESTAMP		 NOT NULL ,
	`CONTENIDO_ORIGINAL_XML`		MEDIUMBLOB		 ,
	`CALLING_ERROR_RESULT`		VARCHAR	 (1024)	 ,
	`NUM_CFD`		VARCHAR	 (128)	 ,
	`TIPO`		VARCHAR	 (8)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `MULTIMEDIO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`MIME_TYPE`		VARCHAR	 (64)	 NOT NULL ,
	`RUTA_CONTENIDO`		VARCHAR	 (512)	 NOT NULL ,
	`SIZE_BYTES`		INTEGER	 (10)	 NOT NULL ,
	`NOMBRE_ARCHIVO`		VARCHAR	 (255)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `METODO_DE_PAGO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`DESCRIPCION`		VARCHAR	 (255)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `FORMA_DE_PAGO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`DESCRIPCION`		VARCHAR	 (255)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `CLIENTE` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`RFC`		VARCHAR	 (16)	 NOT NULL ,
	`RAZON_SOCIAL`		VARCHAR	 (128)	 NOT NULL ,
	`NOMBRE_ESTABLECIMIENTO`		VARCHAR	 (128)	 ,
	`CALLE`		VARCHAR	 (128)	 NOT NULL ,
	`NUM_EXTERIOR`		VARCHAR	 (16)	 NOT NULL ,
	`NUM_INTERIOR`		VARCHAR	 (16)	 ,
	`COLONIA`		VARCHAR	 (128)	 NOT NULL ,
	`MUNICIPIO`		VARCHAR	 (128)	 NOT NULL ,
	`REFERENCIA`		VARCHAR	 (128)	 ,
	`CIUDAD`		VARCHAR	 (128)	 ,
	`CP`		VARCHAR	 (6)	 NOT NULL ,
	`ESTADO`		VARCHAR	 (128)	 NOT NULL ,
	`EMAIL`		VARCHAR	 (64)	 ,
	`TELEFONOS`		VARCHAR	 (128)	 ,
	`CONTACTO`		VARCHAR	 (128)	 ,
	`OBSERVACIONES`		VARCHAR	 (255)	 ,
	`UBICACION_LAT`		DOUBLE		 ,
	`UBICACION_LON`		DOUBLE		 ,
	`NUM_CUENTA`		VARCHAR	 (64)	 ,
	`BANCO`		VARCHAR	 (64)	 ,
	`DIRECCION_FACTURACION`		VARCHAR	 (255)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `CONFIGURACION_SISTEMA` (
	`LLAVE`		VARCHAR	 (128)	 NOT NULL ,
	`VALOR`		VARCHAR	 (255)	 NOT NULL ,
	PRIMARY KEY (`LLAVE`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ALMACEN` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`TIPO_ALMACEN`		INTEGER	 (2)	 NOT NULL ,
	`SUCURSAL_ID`		INTEGER	 (10)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `OFERTA_PRODUCTO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`TIPO`		INTEGER	 (3)	 NOT NULL ,
	`USUARIO_EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 ,
	`ALMACEN_ID`		INTEGER	 (10)	 NOT NULL ,
	`ACTIVA`		INTEGER	 (1)	 NOT NULL ,
	`MARCA`		VARCHAR	 (255)	 ,
	`LINEA`		VARCHAR	 (128)	 ,
	`LEMA`		VARCHAR	 (128)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `USUARIO_PERFIL` (
	`EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`PERFIL`		VARCHAR	 (32)	 NOT NULL ,
	PRIMARY KEY (`EMAIL`, `PERFIL`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `MOVIMIENTO_OPERATIVO_ALMACEN` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`MOTIVO`		VARCHAR	 (255)	 NOT NULL ,
	`USUARIO_GENERO`		VARCHAR	 (64)	 NOT NULL ,
	`FECHA_INICIO`		TIMESTAMP		 NOT NULL ,
	`ALMACEN_ORIGEN`		INTEGER	 (10)	 NOT NULL ,
	`ALMACEN_DESTINO`		INTEGER	 (10)	 NOT NULL ,
	`TIPO_MOVIMIENTO`		INTEGER	 (3)	 NOT NULL ,
	`USUARIO_CONFIRMO`		VARCHAR	 (64)	 ,
	`FECHA_CONFIRMACION`		TIMESTAMP		 ,
	`COMENTARIOS`		VARCHAR	 (255)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ENTRADA_SALIDA` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`TIPO_MOV`		INTEGER	 (10)	 NOT NULL ,
	`SUCURSAL_ID`		INTEGER	 (10)	 NOT NULL ,
	`ESTADO_ID`		INTEGER	 (10)	 NOT NULL ,
	`FECHA_CREO`		TIMESTAMP		 NOT NULL ,
	`USUARIO_EMAIL_CREO`		VARCHAR	 (64)	 NOT NULL ,
	`CLIENTE_ID`		INTEGER	 (10)	 ,
	`FORMA_DE_PAGO_ID`		INTEGER	 (10)	 ,
	`METODO_DE_PAGO_ID`		INTEGER	 (10)	 ,
	`FACTOR_IVA`		DOUBLE	,
	`COMENTARIOS`		VARCHAR	 (255)	 ,
	`CFD_ID`		INTEGER	 (10)	 ,
	`NUMERO_TICKET`		VARCHAR	 (128)	 ,
	`CAJA`		INTEGER	 (2)	 ,
	`IMPORTE_RECIBIDO`		DOUBLE		 ,
	`APROBACION_VISA_MASTERCARD`		VARCHAR	 (64)	 ,
	`PORCENTAJE_DESCUENTO_CALCULADO`		INTEGER	 (2)	 ,
	`PORCENTAJE_DESCUENTO_EXTRA`		INTEGER	 (2)	 ,
	`CONDICIONES_DE_PAGO`		VARCHAR	 (128)	 ,
	`NUM_DE_CUENTA`		VARCHAR	 (32)	 ,
	`AUTORIZA_DESCUENTO`		INTEGER	 (1)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `MOVIMIENTO_HISTORICO_PRODUCTO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`ALMACEN_ID`		INTEGER	 (10)	 NOT NULL ,
	`FECHA`		TIMESTAMP		 NOT NULL ,
	`TIPO_MOVIMIENTO`		INTEGER	 (10)	 NOT NULL ,
	`CANTIDAD`		INTEGER	 (10)	 NOT NULL ,
	`COSTO`		DOUBLE		 ,
	`PRECIO`		DOUBLE		 ,
	`USUARIO_EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 NOT NULL ,
	`ENTRADA_SALIDA_ID`		INTEGER	 (10)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `PRODUCTO_MULTIMEDIO` (
	`MULTIMEDIO_ID`		INTEGER	 (10)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 NOT NULL ,
	PRIMARY KEY (`MULTIMEDIO_ID`, `PRODUCTO_CODIGO_BARRAS`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`MOVIMIENTO_OPERATIVO_ALMACEN_ID`		INTEGER	 (10)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 ,
	`CANTIDAD`		INTEGER	 (10)	 NOT NULL ,
	`CANTIDAD_CONFIRMADA`		INTEGER	 (10)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ENTRADA_SALIDA_DETALLE` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`ENTRADA_SALIDA_ID`		INTEGER	 (10)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 NOT NULL ,
	`ALMACEN_ID`		INTEGER	 (10)	 NOT NULL ,
	`CANTIDAD`		INTEGER	 (10)	 NOT NULL ,
	`PRECIO_VENTA`		DOUBLE		 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ALMACEN_PRODUCTO` (
	`ALMACEN_ID`		INTEGER	 (10)	 NOT NULL ,
	`PRODUCTO_CODIGO_BARRAS`		VARCHAR	 (64)	 NOT NULL ,
	`CANTIDAD`		INTEGER	 (10)	 NOT NULL ,
	`PRECIO`		DOUBLE		 NOT NULL ,
	`UBICACION`		VARCHAR	 (255)	 ,
	PRIMARY KEY (`ALMACEN_ID`, `PRODUCTO_CODIGO_BARRAS`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `CORTE_CAJA` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`FECHA`		TIMESTAMP		 NOT NULL ,
	`SUCURSAL_ID`		INTEGER	 (10)	 NOT NULL ,
	`CAJA`		INTEGER	 (3)	 NOT NULL ,
	`USUARIO_EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`TOTAL`		DOUBLE		 NOT NULL ,
	`COMENTARIOS`		VARCHAR	 (128)	 NOT NULL ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `ENTRADA_SALIDA_ESTADO` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`ENTRADA_SALIDA_ID`		INTEGER	 (10)	 NOT NULL ,
	`ESTADO_ID`		INTEGER	 (10)	 NOT NULL ,
	`FECHA`		TIMESTAMP		 NOT NULL ,
	`USUARIO_EMAIL`		VARCHAR	 (64)	 NOT NULL ,
	`COMENTARIOS`		VARCHAR	 (255)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
CREATE TABLE `SUCURSAL` (
	`ID`		INTEGER	 (10)	 NOT NULL AUTO_INCREMENT ,
	`ID_PADRE`		INTEGER	 (10)	 ,
	`NOMBRE`		VARCHAR	 (128)	 NOT NULL ,
	`DIRECCION`		VARCHAR	 (255)	 ,
	`TELEFONOS`		VARCHAR	 (128)	 ,
	`USUARIO_SICOFI`		VARCHAR	 (64)	 ,
	`PASSWORD_SICOFI`		VARCHAR	 (64)	 ,
	`SERIE_SICOFI`		VARCHAR	 (4)	 ,
	`COMENTARIOS`		VARCHAR	 (255)	 ,
	`DESCUENTO_MAYOREO_HABILITADO`		INTEGER	 (1)	 ,
	PRIMARY KEY (`ID`)
)ENGINE=InnoDB;

-- ===============================================================================
-- =================================== CONSTRAINTS ==============================
ALTER TABLE `ALMACEN` ADD CONSTRAINT FOREIGN KEY (`SUCURSAL_ID`)	REFERENCES `SUCURSAL`(`ID`);
ALTER TABLE `OFERTA_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`USUARIO_EMAIL`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `OFERTA_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `OFERTA_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_ID`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `USUARIO_PERFIL` ADD CONSTRAINT FOREIGN KEY (`EMAIL`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN` ADD CONSTRAINT FOREIGN KEY (`USUARIO_GENERO`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_ORIGEN`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_DESTINO`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN` ADD CONSTRAINT FOREIGN KEY (`USUARIO_CONFIRMO`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`SUCURSAL_ID`)	REFERENCES `SUCURSAL`(`ID`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`ESTADO_ID`)	REFERENCES `ESTADO`(`ID`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`USUARIO_EMAIL_CREO`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`CLIENTE_ID`)	REFERENCES `CLIENTE`(`ID`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`FORMA_DE_PAGO_ID`)	REFERENCES `FORMA_DE_PAGO`(`ID`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`METODO_DE_PAGO_ID`)	REFERENCES `METODO_DE_PAGO`(`ID`);
ALTER TABLE `ENTRADA_SALIDA` ADD CONSTRAINT FOREIGN KEY (`CFD_ID`)	REFERENCES `CFD`(`ID`);
ALTER TABLE `MOVIMIENTO_HISTORICO_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_ID`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `MOVIMIENTO_HISTORICO_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`USUARIO_EMAIL`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `MOVIMIENTO_HISTORICO_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `MOVIMIENTO_HISTORICO_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`ENTRADA_SALIDA_ID`)	REFERENCES `ENTRADA_SALIDA`(`ID`);
ALTER TABLE `PRODUCTO_MULTIMEDIO` ADD CONSTRAINT FOREIGN KEY (`MULTIMEDIO_ID`)	REFERENCES `MULTIMEDIO`(`ID`);
ALTER TABLE `PRODUCTO_MULTIMEDIO` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE` ADD CONSTRAINT FOREIGN KEY (`MOVIMIENTO_OPERATIVO_ALMACEN_ID`)	REFERENCES `MOVIMIENTO_OPERATIVO_ALMACEN`(`ID`);
ALTER TABLE `MOVIMIENTO_OPERATIVO_ALMACEN_DETALLE` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `ENTRADA_SALIDA_DETALLE` ADD CONSTRAINT FOREIGN KEY (`ENTRADA_SALIDA_ID`)	REFERENCES `ENTRADA_SALIDA`(`ID`);
ALTER TABLE `ENTRADA_SALIDA_DETALLE` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `ENTRADA_SALIDA_DETALLE` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_ID`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `ALMACEN_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`ALMACEN_ID`)	REFERENCES `ALMACEN`(`ID`);
ALTER TABLE `ALMACEN_PRODUCTO` ADD CONSTRAINT FOREIGN KEY (`PRODUCTO_CODIGO_BARRAS`)	REFERENCES `PRODUCTO`(`CODIGO_BARRAS`);
ALTER TABLE `CORTE_CAJA` ADD CONSTRAINT FOREIGN KEY (`SUCURSAL_ID`)	REFERENCES `SUCURSAL`(`ID`);
ALTER TABLE `CORTE_CAJA` ADD CONSTRAINT FOREIGN KEY (`USUARIO_EMAIL`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `ENTRADA_SALIDA_ESTADO` ADD CONSTRAINT FOREIGN KEY (`ENTRADA_SALIDA_ID`)	REFERENCES `ENTRADA_SALIDA`(`ID`);
ALTER TABLE `ENTRADA_SALIDA_ESTADO` ADD CONSTRAINT FOREIGN KEY (`ESTADO_ID`)	REFERENCES `ESTADO`(`ID`);
ALTER TABLE `ENTRADA_SALIDA_ESTADO` ADD CONSTRAINT FOREIGN KEY (`USUARIO_EMAIL`)	REFERENCES `USUARIO`(`EMAIL`);
ALTER TABLE `SUCURSAL` ADD CONSTRAINT FOREIGN KEY (`ID_PADRE`)	REFERENCES `SUCURSAL`(`ID`);
