<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

    <f:view contentType="text/html">
        <h:head>
            <f:facet name="first">
                <meta http-equiv="X-UA-Compatible" content="EmulateIE8" />
                <meta content='text/html; charset=UTF-8' http-equiv="Content-Type"/>
                <title><ui:insert name="title"/></title>
            </f:facet>
			<link type="text/css"     rel="stylesheet" href="#{request.contextPath}/css/default.css" />   
			<link rel="shortcut icon" type="image/x-icon" href="#{request.contextPath}/images/turboload/Logo_T3.gif" />
			<link rel="icon"          type="image/x-icon" href="#{request.contextPath}/images/Logo_icono_3.ico"/>
			<ui:insert name="extraCss">
				<!-- HERE INSERT EXTRA CSS -->
			</ui:insert>
        </h:head>

        <h:body>

			<h:form id="formHeader">

				<h:panelGrid columns="2" style="width: 100%;" cellpadding = "0" cellspacing = "1" columnClasses="columnWidth30 centerAlign, columnWidth70 leftAlign">                    
                    
                    <h:panelGrid columns="3" columnClasses="columnWidth10 centerAlign, columnWidth80 leftAlign,columnWidth10 centerAlign " 
                                 cellpadding = "0" cellspacing = "1" rendered="true">
						
						<h:outputLink id="link1" value="#{request.contextPath}/pages/home.jsf">
							<p:graphicImage value="/images/PM_NewLogo_30x30.png" alt="PM" title="PERFUMERIA-MARLEN > INICIO"/>
						</h:outputLink>
						
						<h:panelGrid columns="1" cellpadding = "0" cellspacing = "0">
							<h:panelGroup>
								<h:outputText value="PERFUMERIA MARLEN S.A. DE C.V. DISTRIBUCIONES" styleClass="titleHeader"/>
							</h:panelGroup>
							<h:panelGroup>
								<h:outputText value="L30" styleClass="subtitleHeader"/>
							</h:panelGroup>
							
						</h:panelGrid>
						
						<h:panelGroup>
							<p:ajaxStatus>
								<f:facet name="default">
									<p:graphicImage value="/images/20_loading_stoped_icon.gif" alt=" " title=""/>
								</f:facet>
								<f:facet name="start">
									<p:graphicImage value="/images/20_loading_icon.gif" alt="@" title="Cargando..."/>
								</f:facet>
								<f:facet name="complete">
									<p:graphicImage value="/images/20_loading_stoped_icon.gif" alt=" " title=""/>
								</f:facet>
							</p:ajaxStatus>
						</h:panelGroup>
						
					</h:panelGrid>
									
					<p:menubar>
						<p:submenu label="OPERACI&Oacute;N" icon="ui-icon-gear" rendered="#{sessionUserMB.usuarioAuthenticated.habilitado}">
							
							<p:submenu label="VENTAS" icon="ui-icon-contact"  rendered="#{sessionUserMB.usuarioAuthenticated.playsAsSales}">
								<p:menuitem value="NUEVO"       url="/pages/pedidoVenta.jsf" icon="ui-icon-cart"/>
								<p:menuitem value="EN PROCESO"  url="/pages/pedidosVenta.jsf" icon="ui-icon-calculator"/>								
								<p:menuitem value="HISTORICO"   url="/pages/historicoPedidosVenta.jsf" icon="ui-icon-clock"/>
								<p:menuitem value="SUCURSALES"  url="/pages/ventasSucursales.jsf" icon="ui-icon-home"  rendered="#{sessionUserMB.usuarioAuthenticated.playsAsStock}"/>
							</p:submenu>
							
							<p:submenu label="COMPRAS" icon="ui-icon-arrowstop-1-s"  rendered="#{sessionUserMB.usuarioAuthenticated.playsAsSales and sessionUserMB.usuarioAuthenticated.playsAsStock}">
								<p:menuitem value="NUEVA" url="/pages/nuevaCompra.jsf" icon="ui-icon-cart"/>
								<p:menuitem value="EN PROCESO" url="/pages/compras.jsf" icon="ui-icon-calculator"/>
								<p:menuitem value="HISTORICO" url="/pages/historicoCompras.jsf" icon="ui-icon-clock"/>
							</p:submenu>
							
							<p:submenu label="DEVOL.(VTA)" icon="ui-icon-arrowreturn-1-w" rendered="#{sessionUserMB.usuarioAuthenticated.playsAsSales and sessionUserMB.usuarioAuthenticated.playsAsStock}">
								<p:menuitem value="NUEVA" url="/pages/nuevaDevolucion.jsf" icon="ui-icon-cart"/>
								<p:menuitem value="EN PROCESO" url="/pages/devoluciones.jsf" icon="ui-icon-calculator"/>
								<p:menuitem value="HISTORICO" url="/pages/historicoDevoluciones.jsf" icon="ui-icon-clock"/>
								<p:menuitem value="SUCURSALES"  url="/pages/devolucionesSucursales.jsf" icon="ui-icon-home"/>
							</p:submenu>
							
							<p:submenu label="MERMAS" icon="ui-icon-trash" rendered="false">
								<p:menuitem value="NUEVA" url="/pages/pendiente.jsf" icon="ui-icon-cart"/>
								<p:menuitem value="EN PROCESO" url="/pages/pendiente.jsf" icon="ui-icon-calculator"/>
							</p:submenu>
							
							<p:submenu label="TRASPASOS SUCS." icon="ui-icon-arrowstop-1-e" rendered="#{sessionUserMB.usuarioAuthenticated.playsAsSales}" >
								<p:menuitem value="NUEVO"       url="/pages/nuevoTraspasoSuc.jsf" icon="ui-icon-arrowstop-1-e"  />
								<p:menuitem value="EN PROCESO"  url="/pages/traspasosSuc.jsf"     icon="ui-icon-calculator"     />
								<p:menuitem value="HISTORICO"   url="/pages/historicoTraspasosSuc.jsf"     icon="ui-icon-calculator"     />
							</p:submenu>

						</p:submenu>
						
						<p:submenu label="INVENTARIOS" icon="ui-icon-clipboard" rendered="#{sessionUserMB.usuarioAuthenticated.playsAsStock}">
							<p:menuitem value="PRINCIPAL"   url="/pages/inventarioPrincipal.jsf" icon="ui-icon-home"  rendered="#{sessionUserMB.usuarioAuthenticated.playsAsAdmin}" />
							<p:menuitem value="CONTEO."     url="/pages/pendiente.jsf" icon="ui-icon-shuffle" rendered="false"/>
							<p:menuitem value="SUCURSALES " url="/pages/inventarioSucursal.jsf" icon="ui-icon-home"  rendered="#{sessionUserMB.usuarioAuthenticated.playsAsAdmin}"/>
						</p:submenu>
						
						<p:submenu label="ADMINISTRACI&Oacute;N" icon="ui-icon-suitcase"  rendered="#{sessionUserMB.usuarioAuthenticated.habilitado}">
							
							<p:submenu label="CAT&Aacute;LOGOS" icon="ui-icon-newwin">
								<p:menuitem value="PRODUCTOS" url="/pages/producto.jsf" icon="ui-icon-cart"/>						
								
								<p:menuitem value="CLIENTES"  url="/pages/cliente.jsf" icon="ui-icon-person"/>
								
							</p:submenu>
														
							<p:submenu label="SISTEMA" icon="ui-icon-newwin" rendered="#{sessionUserMB.usuarioAuthenticated.playsAsAdmin}">
								<p:menuitem value="SESIONES ACTIVAS" url="/pages/sesionesActivas.jsf" icon="ui-icon-clock" ></p:menuitem>
								<p:menuitem value="USUARIOS" url="/pages/usuario.jsf" icon="ui-icon-person" />
								<p:menuitem value="SUCURSALES" url="/pages/pendiente.jsf" icon="ui-icon-star" />
								<p:menuitem value="TOKEN"      url="/pages/token.jsf" icon="ui-icon-locked"/>
							</p:submenu>
							
						</p:submenu>
						
						<f:facet name="options">
							<p:menuButton value="#{sessionUserMB.usuarioAuthenticated.nombreCompleto}" >
								<p:menuitem value="AYUDA" url="/pages/ayuda.jsf" icon="ui-icon-help"  rendered="#{sessionUserMB.usuarioAuthenticated.habilitado}"/>
								<p:menuitem value="INFORMACI&Oacute;N USUARIO" url="/pages/informacionUsuario.jsf" icon="ui-icon-contact"  rendered="#{sessionUserMB.usuarioAuthenticated.habilitado}"/>
								<p:menuitem value="WEB-MAIL" url="/pages/pendiente.jsf" icon="ui-icon-mail-closed"  rendered="#{sessionUserMB.usuarioAuthenticated.habilitado}"/>
								<p:menuitem value="SALIR" url="/logout" icon="ui-icon-extlink" />
							</p:menuButton>
						</f:facet>
					</p:menubar>
				</h:panelGrid>				
			</h:form>
			
			<h:form>
				<p:idleMonitor timeout="#{sessionUserMB.timeOutSession}">
					<p:ajax event="idle"   listener="#{sessionUserMB.onIdle}"   oncomplete="window.location.replace('#{request.contextPath}/logout');" />
				</p:idleMonitor>
			</h:form>
			
			<p:panel id="basic" styleClass="preferencesPanel">
				<f:facet name="header">
					<ui:insert name="body-title">BodyTitle</ui:insert>
				</f:facet>

				<h:panelGrid columns="1" style="margin: auto;background-color: transparent; width: 100%; height: 90vh; vertical-align: top;"
							 columnClasses="topTAlign topAlign">
		
					<ui:insert name="body">Body</ui:insert>

				</h:panelGrid>
			</p:panel>
			<br/>
			
			<h:panelGroup class="footer-bar-#{systemInfoMB.environment}">
                
                <h:form id="footer_form">
					<h:panelGrid columns="4" id="footer_bar" rendered="#{empty sessionUserMB.messageForSession}"
                                 columnClasses="columnWidth5 leftAlign,columnWidth90 centerAlign, columnWidth5 rightAlign" width="100%">
						<span id="txtTimeoutClock" class="txtTimeoutClock" style="color: greenyellow;" title="TIEMPO RESTANTE PARA EXPIRE LA SESI&Oacute;N"></span>
						<h:panelGroup>
							<h:outputText	value="Perfumeria Marlen - L30 @ AWS | "/>
							<h:outputText	value="Construido: #{systemInfoMB.buildTimestamp} | " 
											title="Ver. #{systemInfoMB.systemVersion} ( #{systemInfoMB.environment} ) Git RevID: #{systemInfoMB.gitSHA1}" />
							<h:outputLink id="link1" value="#{request.contextPath}/pmcajaupdate/version.properties">
								<h:outputText	value="PMCaja Ver." title="PM Caja Ver."/>
							</h:outputLink>
						
							<h:outputText	value="| UA"
										    title="#{sessionUserMB.uaInfo}"/>
						</h:panelGroup>
                        <h:panelGroup>
                            <h:outputText id="txtFoter" class="txtFoter" value="#{systemInfoMB.sessionDate}" style="color: greenyellow;" title="HORA DEL SISTEMA, VERDE: ESTA EN LINEA, ROJO: DESCONECTADO[#{systemInfoMB.broadcastMessage}]" />
                        </h:panelGroup>                        
					</h:panelGrid>
                    
                    <h:panelGrid columns="4" id="footer_bar_msg" rendered="#{not empty sessionUserMB.messageForSession}"
                                 columnClasses="columnWidth5 leftAlign,columnWidth35 centerAlign, columnWidth55 centerAlign, columnWidth5 rightAlign" width="100%">
						<span id="txtTimeoutClock_msg" class="txtTimeoutClock" style="color: greenyellow;" title="TIEMPO RESTANTE PARA EXPIRE LA SESI&Oacute;N"></span>
						<h:panelGroup>
							<h:outputText	value="Perfumeria Marlen - L30 | "/>
							<h:outputText	value="Construido: #{systemInfoMB.buildTimestamp} | " 
											title="Ver. #{systemInfoMB.systemVersion} ( #{systemInfoMB.environment} ) Git RevID: #{systemInfoMB.gitSHA1}" />
							<h:outputLink id="link1_msg" value="#{request.contextPath}/pmcajaupdate/version.properties">
								<h:outputText	value="PMCaja Ver." title="PM Caja Ver."/>
							</h:outputLink>
						
							<h:outputText	value="| UA"
										    title="#{sessionUserMB.uaInfo}"/>
						</h:panelGroup>
                        <h:panelGroup>
                            <h:panelGrid columns="3" columnClasses="columnWidth5 rightAlign table_debug_borders,columnWidth80 centerAlign table_debug_borders,columnWidth15 leftAlign table_debug_borders" 
                                         class="table_debug_borders" width="100%">
                                <p:graphicImage value="/images/warning.gif" alt="[!]" title="!"/>
                                
                                <h:outputText value="#{sessionUserMB.messageForSession}" style="font-size:12px; color: tomato;" id="notificationBar_msg"/>                                    
                                
                                <p:commandLink value="[ OK, ENTERADO ]" actionListener="#{sessionUserMB.messageRead}" onsuccess="successGetTime();" update=":footer_form"/>
                            </h:panelGrid>
                        </h:panelGroup>
                        <h:panelGroup>
                            <h:outputText id="txtFoter_msg" class="txtFoter" value="#{systemInfoMB.sessionDate}" style="color: greenyellow;" title="HORA DEL SISTEMA, VERDE: ESTA EN LINEA, ROJO: DESCONECTADO[#{systemInfoMB.broadcastMessage}]" />
                        </h:panelGroup>                        
					</h:panelGrid>
                    
					<p:poll interval="300" 
                            listener="#{systemInfoMB.updateTime}" 
                            onerror="errorGetTime();"                            
                            onsuccess="successGetTime();"
                            update=":footer_form"
                            rendered="true"/>

					<script>
						
						var informeDescinetado = false;
						function errorGetTime(){
							$(".txtFoter").css({ "color": 'red'});
							if(!informeDescinetado) {
								informeDescinetado = true;
								alert("SE PERDI&Oacute; LA CONECCI&Oacute;N, SE REDIRECCIONARA A LA DIRECCI&Oacute;N DE INCIO");
								window.location.href = "#{request.contextPath}/";
							}
						}
						
						function successGetTime(){
							informeDescinetado = false;
							$(".txtFoter").css({ "color": 'greenyellow'});
						}
                        
						var endTime, hours, mins, msLeft, time;
						var elementObject;
						
						function twoDigits( n ) {
							return (n &lt;= 9)? ("0" + n) : n;
						}
						function updateTimer(){
							
							msLeft = endTime - (+new Date);
							if ( msLeft &lt; 1000 ) {
								elementObject.text("--:--");
								window.location = "#{request.contextPath}/logout";
							} else {
								time = new Date( msLeft );
								hours = time.getUTCHours();
								mins = time.getUTCMinutes();
									
								elementObject.text("" +(hours ? hours + ':' + twoDigits( mins ) : mins) + ':' + twoDigits( time.getUTCSeconds() ));
								
								setTimeout( updateTimer, time.getUTCMilliseconds() + 500 );
							}
						}
						function countdown( elementClass, minutes, seconds ) {
							
							elementObject = $(elementClass);
							
							elementObject.text("##:##");
							
							endTime = (+new Date) + 1000 * (60*minutes + seconds) + 500;
							updateTimer();
						}

						$.ready(new function(){
							countdown(".txtTimeoutClock" ,#{sessionUserMB.timeOutSessionInMinutes}, #{sessionUserMB.timeOutSessionInSecondsOfMinutes});
						});
						
					</script>					
					
					
				</h:form>
				
			</h:panelGroup>

        </h:body>

    </f:view>
</html>
